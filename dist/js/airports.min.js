/*! airports-js 28-11-2014 */
define(function(){function a(a){return(1-Math.cos(a))/2}function b(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}function c(b,c,d,e){return b*=j,d*=j,c*=j,e*=j,2*i*Math.asin(Math.sqrt(a(d-b)+Math.cos(b)*Math.cos(d)*a(e-c)))}function d(){$("#map-container").html("")}function e(a,b){var c="origin="+a+"&destination="+b;$("#map-container").html('             <iframe                 width="100%"                 height="500px"                 frameborder="0" style="border:0"                 src="https://www.google.com/maps/embed/v1/directions?key=AIzaSyB-nTCsOb7rFXj-97PHNbRopLpa2uvH6S0&'+c+'">             </iframe>         ')}function f(){var a=$("#airport-desc-1").data("data"),f=$("#airport-desc-2").data("data");if(a&&!a.error&&f&&!f.error){var g=c(a.lat,a.lng,f.lat,f.lng);$("#distance-1").html("<strong>Distance:</strong> "+b(g,2)+" km, "+b(g*k,2)+" nmi"),e(a.code+" airport",f.code+" airport")}else $("#distance-1").html(""),d()}function g(a){a.removeData("data"),a.html(""),f()}function h(a,c){c?(c.error&&g(a),a.data("data",c),c.error||a.html("<strong>"+c.code+"</strong> - "+c.name+"<br>"+c.city+", "+c.country+" ("+b(c.lat,2)+", "+b(c.lng,2)+")"),f()):a.html("loading...")}var i=6367.4445,j=Math.PI/180,k=.539957;return{lookupAirport:function(a){a=$(a);var b=a.val().toUpperCase(),c=$("#"+a.attr("id").replace("input","desc")),d=c.data("data");if(d){var e=d.code;if(b==e)return}g(c),3==b.length&&(h(c),$.ajax({url:"/api/airports/"+b}).done(function(a){h(c,a)}).fail(function(){h(c,{code:b,error:!0})}))},getSuggestions:function(a,b){$.ajax({url:"/api/airports/search/"+a.toLowerCase()}).done(function(a){a&&b(a.slice(0,30))})},renderSuggestion:function(a){var b=a.code;a.name&&(b+=" - "+a.name);var c="";return a.city&&(c+=a.city),a.country&&(c.length&&(c+=" - "),c+=a.country),'<div class="suggestion"><div class="suggestion-main">'+b+'</div><div class="suggestion-sub">'+c+"</div></div>"},renderNoSuggestions:function(){return'<div class="suggestion"><span class="suggestion-empty">no suggestions</span></div>'},initDemo:function(a,b,c){var d="/dist/airports-js/dist/css/demo.css";c.createStyleSheet?c.createStyleSheet(d):a("head").append(a("<link rel='stylesheet' href='"+d+"' type='text/css' media='screen' />")),a("#demo").html('                 <div id="demo-container">                     <div class="row">                         <div class="col-xs-12 col-md-5">                             <div id="airports">                                 <div class="airport"><input id="airport-input-1" type="text" class="airport-input" placeholder="type something"><div id="airport-desc-1" class="airport-desc"></div></div>                                 <div class="airport"><input id="airport-input-2" type="text" class="airport-input" placeholder="type something"><div id="airport-desc-2" class="airport-desc"></div></div>                                 <div class="distance" id="distance-1"></div>                             </div>                         </div>                         <div class="col-xs-12 col-md-7">                             <div id="map-container">                             </div>                         </div>                     </div>                 </div>             ');var e=this;a(".airport-input").typeahead({minLength:1,hint:!1,highlight:!0},{name:"airport-search",source:function(a,b){e.getSuggestions(a,b)},displayKey:"code",templates:{suggestion:this.renderSuggestion,empty:this.renderNoSuggestions}}),a(".airport-input").bind("typeahead:selected change blur",function(){e.lookupAirport(this)}),a(".airport-input").bind("keyup",function(b){return e.lookupAirport(this),13==b.which&&a(".airport-input").typeahead("close"),!0})}}});