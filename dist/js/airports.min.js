/*! airports-js 28-11-2014 */
define(function(){function a(a){return(1-Math.cos(a))/2}function b(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}function c(b,c,d,e){return b*=h,d*=h,c*=h,e*=h,2*g*Math.asin(Math.sqrt(a(d-b)+Math.cos(b)*Math.cos(d)*a(e-c)))}function d(){var a=$("#airport-desc-1").data("data"),d=$("#airport-desc-2").data("data");if(a&&d){var e=c(a.lat,a.lng,d.lat,d.lng);$("#distance-1").html("<strong>Distance:</strong> "+b(e,2)+" km, "+b(e*i,2)+" nmi")}else $("#distance-1").html("")}function e(a){a.removeData("data"),a.html(""),d()}function f(a,c){c?(c.error&&e(a),a.data("data",c),c.error||a.html("<strong>"+c.code+"</strong> - "+c.name+"<br>"+c.city+", "+c.country+" ("+b(c.lat,2)+", "+b(c.lng,2)+")"),d()):a.html("loading...")}var g=6367.4445,h=Math.PI/180,i=.539957;return{lookupAirport:function(a){a=$(a);var b=a.val().toUpperCase(),c=$("#"+a.attr("id").replace("input","desc")),d=c.data("data");if(d){var g=d.code;if(b==g)return}e(c),3==b.length&&(f(c),$.ajax({url:"/api/airports/"+b}).done(function(a){f(c,a)}).fail(function(){f(c,{code:b,error:!0})}))},getSuggestions:function(a,b){$.ajax({url:"/api/airports/search/"+a.toLowerCase()}).done(function(a){a&&b(a.slice(0,30))})},renderSuggestion:function(a){var b=a.code;a.name&&(b+=" - "+a.name);var c="";return a.city&&(c+=a.city),a.country&&(c.length&&(c+=" - "),c+=a.country),'<div class="suggestion"><div class="suggestion-main">'+b+'</div><div class="suggestion-sub">'+c+"</div></div>"},renderNoSuggestions:function(){return'<div class="suggestion"><span class="suggestion-empty">no suggestions</span></div>'},initDemo:function(a,b,c){var d="/dist/airports-js/dist/css/demo.css";c.createStyleSheet?c.createStyleSheet(d):a("head").append(a("<link rel='stylesheet' href='"+d+"' type='text/css' media='screen' />")),a("#demo").html('                 <div id="demo-container">                     <div class="row">                         <div class="col-xs-12 col-md-5">                             <div id="airports">                                 <div class="airport"><input id="airport-input-1" type="text" class="airport-input" placeholder="type something"><div id="airport-desc-1" class="airport-desc"></div></div>                                 <div class="airport"><input id="airport-input-2" type="text" class="airport-input" placeholder="type something"><div id="airport-desc-2" class="airport-desc"></div></div>                                 <div class="distance" id="distance-1"></div>                             </div>                         </div>                         <div class="col-xs-12 col-md-7">                             <div id="mapContainer">                             </div>                         </div>                     </div>                 </div>             ');var e=this;a(".airport-input").typeahead({minLength:1,hint:!1,highlight:!0},{name:"airport-search",source:function(a,b){e.getSuggestions(a,b)},displayKey:"code",templates:{suggestion:this.renderSuggestion,empty:this.renderNoSuggestions}}),a(".airport-input").bind("typeahead:selected change blur",function(){e.lookupAirport(this)}),a(".airport-input").bind("keyup",function(b){return e.lookupAirport(this),13==b.which&&a(".airport-input").typeahead("close"),!0})}}});